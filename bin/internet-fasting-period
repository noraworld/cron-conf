#!/bin/sh

PROGNAME=$(basename $0)

FILEPATH=/home/ubuntu/.internet_fasting_period
PRIV_FILEPATH=/home/ubuntu/.internet_fasting_priv_period

main() {
  subcommand=$1
  period=$2

  case $subcommand in
    get)
      get_value
      ;;
    set)
      validate_value
      set_value
      get_value
      ;;
    *)
      usage
      exit 1
      ;;
  esac
}

get_value() {
  echo -n "$(basename $FILEPATH): "
  cat      $FILEPATH
  echo -n "$(basename $PRIV_FILEPATH): "
  cat      $PRIV_FILEPATH
}

set_value() {
  echo $period > $FILEPATH
  echo $period > $PRIV_FILEPATH

  if [ "$(diff $FILEPATH $PRIV_FILEPATH)" != "" ]; then
    echo "Error: diff between two files exists" >&2
    exit 2
  fi
}

validate_value() {
  if [ -z $period ]; then
    usage
    exit 1
  fi

  if ! $(is_integer $period && echo true || echo false); then
    echo "Error: \"$period\" is not a integer value" >&2
    exit 1
  fi
}

is_integer() {
  test 0 -eq $1 > /dev/null 2>&1 || expr $1 + 0 > /dev/null 2>&1
}

usage() {
  echo "Usage:"
  echo "	$PROGNAME get"
  echo "	$PROGNAME set <NUMBER>"
}

main "$@"
