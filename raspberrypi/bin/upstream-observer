#!/bin/sh

main() {
  if
    [ "$(systemctl --user is-active observe-adguard-upstream-conf)" != "active" ] &&
    [ "$(quotarget --timeframe now --service upstream --cache-only)" -gt 0 ] &&
    [ "$(sincere --cache-only)" -gt 0 ]
  then
    # They wouldn't restart Dnsmasq if there's no changes
    create-dnsmasq-toggle-conf private adguard_upstream    --quiet
    remove-dnsmasq-toggle-conf private nordvpn_upstream    --quiet
    remove-dnsmasq-toggle-conf private superman_upstream   --quiet
    remove-dnsmasq-toggle-conf private cloudflare_upstream --quiet
  else
    # They wouldn't restart Dnsmasq if there's no changes
    create-dnsmasq-toggle-conf private superman_upstream   --quiet
    remove-dnsmasq-toggle-conf private adguard_upstream    --quiet
    remove-dnsmasq-toggle-conf private nordvpn_upstream    --quiet
    remove-dnsmasq-toggle-conf private cloudflare_upstream --quiet
  fi
}

main "$@"
